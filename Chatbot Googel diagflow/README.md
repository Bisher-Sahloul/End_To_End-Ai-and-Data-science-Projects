Chatbot for food orders online delivery using Dialogflow
===================
Build a chatbot for food orders online delivery using Google's Dialogflow ES. This bot supports two options,

1) New Order
2) Track Order
3) Store Hours
1) New Order: Sample Conversation

```
Bot: How can I help you? You can say things like (1) New Order (2) Track Order
User: New Order
Bot: What would you like to have? You can say things like 2 pizzas, one vada pav.
     Only order from this list: Vada Pav, Pav Bhaji, Mango Lassi, Pizza, Rava Dosa, Masala Dosa, Samosa
User: I would like to have 2 Rava Dosa and one plate of samosa
Bot: Added 2 Rava Dosa and 1 Samosa. Anything else?
User: Oh yes, add one mango lassi, please
Bot: Sure. Now we have 2 Rava Dosa, 1 Samosa and 1 Mango Lassi. Anything else?
User: Well, you know my cholesterol came high so let's remove Samosa
Bot: Sure. Now we have 2 Rava Dosa, and 1 Mango Lassi. Anything else?
User: Nope. That's it
Bot: Awesome. Your order is placed. Order id # 45. Your total bill is 19$ which you can pay at the time of delivery!
```

2) Track Order: Sample Conversation

```Bot: How can I help you? You can say things like (1) New Order (2) Track Order
User: Track Order
Bot: What is your order id?
User: 45
Bot: Order # 45, is in transit
User: How about 41
Bot: ORder # 41 is delivered
```


Directory structure
===================
backend: Contains Python FastAPI backend code
db: contains the dump of the database. you need to import this into your MySQL db by using MySQL workbench tool
dialogflow_assets: this has training phrases etc. for our intents
frontend: website code

Install these modules
======================

pip install mysql-connector
pip install "fastapi[all]"

OR just run pip install -r backend/requirements.txt to install both in one shot

To start fastapi backend server
================================
1. Go to backend directory in your command prompt
2. Run this command: uvicorn main:app --reload

ngrok for https tunneling
================================
1. To install ngrok, go to https://ngrok.com/download and install ngrok version that is suitable for your OS
2. Extract the zip file and place ngrok.exe in a folder.
3. Open windows command prompt, go to that folder and run this command: ngrok http 80000

NOTE: ngrok can timeout. you need to restart the session if you see session expired message.

Telegram Bot Deployment
=======================

This chatbot can be deployed and used directly on **Telegram** using **Dialogflow ES** and **BotFather**.

Step 1: Create Telegram Bot using BotFather
-------------------------------------------
1. Open Telegram and search for **@BotFather**
2. Start the chat and run:
   ```
   /newbot
   ```
3. Choose a name and username for your bot  
   Example:
   ```
   AI_AGENT_ABAAS_bot
   ```
4. BotFather will generate a **Bot Token**

⚠️ Keep the Bot Token secret and do not commit it to the repository.

---

Step 2: Enable Telegram Integration in Dialogflow
-------------------------------------------------
1. Go to **Dialogflow ES Console**
2. Select your agent
3. Navigate to:
   ```
   Integrations → Telegram
   ```
4. Enable Telegram integration
5. Paste the **Bot Token** generated by BotFather
6. Enter your bot username:
   ```
   @AI_AGENT_ABAAS_bot
   ```
7. Click **Save**

Dialogflow will now automatically receive and respond to Telegram messages.

---

Step 3: Configure Fulfillment Webhook
-------------------------------------
1. Start the FastAPI backend server:
   ```bash
   uvicorn main:app --reload
   ```
2. Expose the backend using **ngrok**:
   ```bash
   ngrok http 8000
   ```
3. Copy the generated HTTPS URL (example):
   ```
   https://xxxx-xx-xx.ngrok-free.app
   ```
4. In Dialogflow:
   - Go to **Fulfillment**
   - Enable **Webhook**
   - Paste the ngrok HTTPS URL
   - Save

---

Step 4: Test the Bot on Telegram
--------------------------------
1. Open Telegram
2. Search for:
   ```
   @AI_AGENT_ABAAS_bot
   ```
3. Start chatting with the bot
4. Test features:
   - New Order
   - Modify Order
   - Track Order by order ID

---

Notes
-----
- ngrok sessions may expire; restart ngrok and update the webhook URL if needed
- For production deployment, replace ngrok with a real domain and SSL certificate
- Always use HTTPS for Dialogflow webhooks
